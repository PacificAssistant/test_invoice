{% extends "base.html" %}

{% block title %}Створення Документа{% endblock %}

{% block head %}
    
{% endblock %}

{% block content %}
    <div style="text-align: center; margin-bottom: 20px;">
        <h1>Створення Нового Облікового Документа</h1>
        <p><a href="{{ url_for('documents_list') }}">← Назад до списку</a></p>
    </div>
    
    {% if error %}
        <p class="error-message">{{ error }}</p>
    {% endif %}

    <form method="POST">
        {{ form.hidden_tag() }}

        <h2>Заголовок Документа</h2>
        
        <div class="form-group">
            {{ form.operation_type.label }} {{ form.operation_type(class="form-control") }} 
            
            {% if form.operation_type.errors %}
                {% for error in form.operation_type.errors %}
                    <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            {% endif %}
        </div>

        <div class="form-group">
            <label for="document_date">Дата Документа:</label>
            <input type="date" id="document_date" name="document_date" value="{{ today_date }}" required>
        </div>
        
        <div class="form-group">
            {{ form.counterparty_id.label }}
            {{ form.counterparty_id() }}
            {% if form.counterparty_id.errors %}
                {% for error in form.counterparty_id.errors %}
                    <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            {% endif %}
        </div>
        
        <div class="document-lines">
            <h2>Товари / Послуги</h2>
            
            <div id="lines-container">
                {% for line_form in form.lines %}
                <div class="line-row" data-line-index="{{ loop.index0 }}">
                    <div>
                        <label for="{{ line_form.nomenclature_id.id }}">Номенклатура:</label>
                        <select id="{{ line_form.nomenclature_id.id }}" name="{{ line_form.nomenclature_id.name }}" required>
                            <option value="">Оберіть номенклатуру</option>
                            {% for item in nomenclatures %}
                                <option value="{{ item.nomenclature_id }}" 
                                    {% if line_form.nomenclature_id.data == item.nomenclature_id %}selected{% endif %}>
                                    {{ item.nomenclature_name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="{{ line_form.quantity.id }}">Кількість:</label>
                        <input type="number" 
                            id="{{ line_form.quantity.id }}" 
                            name="{{ line_form.quantity.name }}" 
                            value="{{ line_form.quantity.data or 1 }}" 
                            min="0.01" step="any" required>
                    </div>
                    <div>
                        <label for="{{ line_form.price_with_vat.id }}">Ціна:</label>
                        <input type="number" 
                            id="{{ line_form.price_with_vat.id }}" 
                            name="{{ line_form.price_with_vat.name }}" 
                            value="{{ line_form.price_with_vat.data or 0.00 }}" 
                            min="0.01" step="any" required>
                    </div>
                    
                    <div class="remove-btn-container">
                        {% if loop.index0 > 0 %}
                        <button type="button" class="btn-remove" onclick="removeLine(this)">X</button>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <button type="button" class="btn-add" onclick="addLine()">+ Додати Рядок</button> 
        </div>

        <div class="form-group" style="margin-top: 30px; border-top: 2px solid #333; padding-top: 20px;">
            <button type="submit" style="background-color: #28a745; color: white; font-size: 18px; font-weight: bold; cursor: pointer; padding: 12px;">
                Зберегти Документ
            </button>
        </div>
    </form>
{% endblock %}

{% block scripts %}
    
{% endblock %}