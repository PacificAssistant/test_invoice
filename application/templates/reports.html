{% extends "base.html" %}

{% block title %}Звіти{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>Аналітичні звіти</h1>
    
    <form method="POST" class="row g-3 align-items-end mb-4" style="border: 1px solid #eee; padding: 15px; border-radius: 8px;">
        {{ form.hidden_tag() }}
        
        <div class="col-md-3">
            {{ form.report_type.label(class="form-label") }}
            {{ form.report_type(class="form-select") }}
        </div>
        
        <div class="col-md-3">
            {{ form.start_date.label(class="form-label") }}
            {{ form.start_date(class="form-control", type="date") }}
        </div>
        
        <div class="col-md-3">
            {{ form.end_date.label(class="form-label") }}
            {{ form.end_date(class="form-control", type="date") }}
        </div>
        
        <div class="col-md-3">
            <button type="submit" class="btn btn-primary w-100">Сформувати звіт</button>
        </div>
    </form>

    <hr>

    {% if results %}
        {% if report_type == 'sales' %}
            <h3>Звіт про продажі</h3>
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Дата</th>
                        <th>№ Документа</th>
                        <th>Клієнт</th>
                        <th>Товар</th>
                        <th>К-ть</th>
                        <th>Сума (грн)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in results %}
                    <tr>
                        <td>{{ row.document_date.strftime('%Y-%m-%d') }}</td>
                        <td>{{ row.documents_id[:8] }}...</td>
                        <td>{{ row.counterparty_name }}</td>
                        <td>{{ row.nomenclature_name }}</td>
                        <td>{{ row.quantity }}</td>
                        <td class="text-end">{{ "%.2f"|format(row.total_amount) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr class="table-warning fw-bold">
                        <td colspan="5" class="text-end">ВСЬОГО ЗА ПЕРІОД:</td>
                        <td class="text-end">{{ "%.2f"|format(total_sum) }}</td>
                    </tr>
                </tfoot>
            </table>

        {% elif report_type == 'inventory_date' %}
            <h3>Залишки на дату: {{ form.end_date.data }}</h3>
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Товар</th>
                        <th class="text-end">Залишок (К-ть)</th>
                        </tr>
                </thead>
                <tbody>
                    {% for row in results %}
                    <tr>
                        <td>{{ row.nomenclature_name }}</td>
                        <td class="text-end fw-bold">{{ row.balance_qty }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}

    {% elif request.method == 'POST' %}
        <div class="alert alert-info">За даним запитом даних не знайдено.</div>
    {% endif %}
</div>
{% endblock %}