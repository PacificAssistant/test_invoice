<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–î—Ä—É–∫: {{ document.operation_type }} ‚Ññ{{ document.documents_id[:8] }}</title>
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –ê4 */
        body {
            font-family: "Times New Roman", Times, serif;
            font-size: 12pt;
            margin: 0;
            padding: 20px;
            color: #000;
        }
        .page-container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
        }
        
        /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
        h1 { font-size: 18pt; text-align: center; margin-bottom: 10px; }
        .header-line { border-bottom: 2px solid #000; margin-bottom: 20px; }
        
        /* –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω—ñ –±–ª–æ–∫–∏ */
        .info-grid {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .info-column { width: 48%; }
        .label { font-weight: bold; }

        /* –¢–∞–±–ª–∏—Ü—è */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        th, td {
            border: 1px solid #000;
            padding: 5px;
            text-align: left;
            font-size: 11pt;
        }
        th { background-color: #f0f0f0; text-align: center; font-weight: bold; }
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        
        /* –ü—ñ–¥—Å—É–º–æ–∫ */
        .totals {
            margin-left: auto;
            width: 40%;
            margin-bottom: 40px;
        }
        .totals-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .totals-row.main { font-weight: bold; font-size: 13pt; }

        /* –ü—ñ–¥–ø–∏—Å–∏ */
        .signatures {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
        }
        .sign-block {
            width: 45%;
            border-top: 1px solid #000;
            padding-top: 10px;
            text-align: center;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –¥—Ä—É–∫—É (—Ö–æ–≤–∞—î–º–æ –∫–Ω–æ–ø–∫—É) */
        @media print {
            .no-print { display: none; }
            @page { margin: 1cm; }
            body { -webkit-print-color-adjust: exact; }
        }
    </style>
</head>
<body>

    <div class="no-print" style="text-align: center; padding: 10px; background: #eee; margin-bottom: 20px;">
        <button onclick="window.print()" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">üñ®Ô∏è –î—Ä—É–∫—É–≤–∞—Ç–∏</button>
        <button onclick="window.close()" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">–ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>

    <div class="page-container">
        <h1>{{ document.operation_type }} ‚Ññ {{ document.documents_id[:8] }}</h1>
        <div style="text-align: center; margin-bottom: 20px;">
            –≤—ñ–¥ {{ document.document_date.strftime('%d.%m.%Y') }} —Ä–æ–∫—É
        </div>
        <div class="header-line"></div>

        <div class="info-grid">
            <div class="info-column">
                <p><span class="label">–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫:</span><br>
                –¢–û–í "–ù–∞—à–∞ –ö–æ–º–ø–∞–Ω—ñ—è"<br>
                –Ñ–î–†–ü–û–£: 12345678<br>
                –†/–†: UA00000000000000000000
                </p>
            </div>
            <div class="info-column">
                <p><span class="label">–û–¥–µ—Ä–∂—É–≤–∞—á (–ü–ª–∞—Ç–Ω–∏–∫):</span><br>
                {{ document.counterparty.counterparty_name }}<br>
                {% if document.contract_name %}
                –î–æ–≥–æ–≤—ñ—Ä: {{ document.contract_name }}
                {% endif %}
                </p>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th style="width: 5%;">‚Ññ</th>
                    <th>–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É (–ø–æ—Å–ª—É–≥–∏)</th>
                    <th style="width: 10%;">–ö-—Ç—å</th>
                    <th style="width: 10%;">–û–¥.</th>
                    <th style="width: 15%;">–¶—ñ–Ω–∞</th>
                    <th style="width: 15%;">–°—É–º–∞</th>
                </tr>
            </thead>
            <tbody>
                {% set totals = namespace(amount=0.0) %}
                {% for line in lines %}
                <tr>
                    <td class="text-center">{{ loop.index }}</td>
                    <td>{{ line.nomenclature.nomenclature_name }}</td>
                    <td class="text-right">{{ line.quantity }}</td>
                    <td class="text-center">{{ line.unit or '—à—Ç' }}</td>
                    <td class="text-right">{{ line.price_with_vat }}</td>
                    <td class="text-right">{{ line.total_with_vat }}</td>
                </tr>
                {% set totals.amount = totals.amount + (line.total_with_vat | string | float) %}
                {% endfor %}
            </tbody>
        </table>

        <div class="totals">
            <div class="totals-row">
                <span>–°—É–º–∞ –±–µ–∑ –ü–î–í:</span>
                <span>{{ "%.2f"|format(totals.amount / 1.2) }} –≥—Ä–Ω</span>
            </div>
            <div class="totals-row">
                <span>–ü–î–í (20%):</span>
                <span>{{ "%.2f"|format(totals.amount - (totals.amount / 1.2)) }} –≥—Ä–Ω</span>
            </div>
            <div class="totals-row main">
                <span>–í—Å—å–æ–≥–æ –¥–æ —Å–ø–ª–∞—Ç–∏:</span>
                <span>{{ "%.2f"|format(totals.amount) }} –≥—Ä–Ω</span>
            </div>
        </div>

        <div class="signatures">
            <div class="sign-block">
                –í—ñ–¥–ø—É—Å—Ç–∏–≤ (–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫)
            </div>
            <div class="sign-block">
                –û—Ç—Ä–∏–º–∞–≤ (–î–æ–≤—ñ—Ä–µ–Ω–∞ –æ—Å–æ–±–∞)
            </div>
        </div>
    </div>

    <script>
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –¥—Ä—É–∫ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.onload = function() {
           // window.print(); // –†–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ, —è–∫—â–æ —Ö–æ—á–µ—Ç–µ –º–∏—Ç—Ç—î–≤–∏–π –¥—Ä—É–∫
        }
    </script>
</body>
</html>